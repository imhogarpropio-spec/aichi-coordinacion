{% extends 'base.html' %}
{% block title %}B√∫squeda de Personal{% endblock %}

{% block content %}

<a href="{{ url_for('dashboard_bp.dashboard') }}" class="btn btn-secondary mb-3">
  ‚¨ÖÔ∏è Regresar al Men√∫ principal
</a>

<div class="container mt-4">
  <h4 class="mb-4">üîç Buscar personal</h4>

  <form method="POST" class="row g-2 mb-4">
    <div class="col-md-3">
      <input type="text" name="apellido_paterno" class="form-control" placeholder="Apellido paterno"
             value="{{ request.form.get('apellido_paterno','') }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="apellido_materno" class="form-control" placeholder="Apellido materno"
             value="{{ request.form.get('apellido_materno','') }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="nombre" class="form-control" placeholder="Nombre(s)"
             value="{{ request.form.get('nombre','') }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="curp" class="form-control" placeholder="CURP"
             value="{{ request.form.get('curp','') }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="rfc" class="form-control" placeholder="RFC"
             value="{{ request.form.get('rfc','') }}">
    </div>

    <div class="col-md-3">
      <input type="text" name="domicilio" class="form-control" placeholder="Domicilio"
            value="{{ request.form.get('domicilio','') }}">
    </div>
    
    <div class="col-md-3">
      <input type="text" name="colonia" class="form-control" placeholder="Colonia"
             value="{{ request.form.get('colonia','') }}">
    </div>

    <div class="col-md-3">
      <button type="submit" class="btn btn-primary w-100">üîç Buscar</button>
    </div>
  </form>

  {% if resultados %}
  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>Nombre completo</th>
          <th>CURP</th>
          <th>RFC</th>
          <th>CCT</th>
          <th>Delegaci√≥n</th>
          <th>Colonia</th>  <!-- üëà opcional, √∫til para validar la b√∫squeda -->
          <th>Ficha</th>
        </tr>
      </thead>
      <tbody>
        {% for persona in resultados %}
        <tr>
          <td>{{ persona.apellido_paterno }} {{ persona.apellido_materno }} {{ persona.nombre }}</td>
          <td>{{ persona.curp }}</td>
          <td>{{ persona.rfc }}</td>
          <td>{{ persona.cct }}</td>
          <td>
            {{ persona.plantel.delegacion.nombre
               if persona.plantel and persona.plantel.delegacion else '' }}
          </td>
          <td>{{ persona.colonia or '' }}</td>
          <td>
            <a href="{{ url_for('personal_bp.vista_detalle_personal', id=persona.id) }}"
               class="btn btn-outline-secondary btn-sm">üìÑ Ver ficha</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% elif request.method == 'POST' %}
    <div class="alert alert-warning">No se encontraron coincidencias.</div>
  {% endif %}
</div>
{% endblock %}
